<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parcours Onboarding</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1 id="main-title">Parcours Onboarding</h1>
            <p id="main-subtitle">Guide d'int√©gration pour les nouveaux collaborateurs</p>
        </header>

        <!-- Accessibilit√©/UX: S√©lecteur de r√¥le sans d√©pendance, persistant par langue.
             Conception: Pas de framework. Les √©l√©ments restent pr√©sents dans le DOM pour √©viter des reflows co√ªteux.
             Politique: Les √©l√©ments non cibl√©s sont repli√©s plut√¥t que supprim√©s pour une UX indulgente. -->
        <div class="role-switch" role="group" aria-label="S√©lecteur de r√¥le">
            <span>Choisissez votre parcours :</span>
            <button type="button" class="role-btn" data-role-select="arrivee" aria-pressed="true">Premiers jours dans l'entreprise</button>
            <button type="button" class="role-btn" data-role-select="nouveau-projet" aria-pressed="false">Lancement d'un nouveau projet</button>
        </div>

        <main class="main-content">
            <!-- Vue Arriv√©e -->
            <div data-view="arrivee" class="view-container">
                <section class="week-section">
                    <h2 id="arrivee-title">Arriv√©e ‚Äî Installation & Formation initiale</h2>
                    
                    <div class="subsection">
                        <h3>Configuration</h3>
                        <div class="task-list">
                            <div class="task-item" data-role="both" data-duration="5‚Äì10 min" data-outcome="Demande envoy√©e">
                                <h4>Cr√©ation compte Sitemark</h4>
                                <p>Demander la cr√©ation de votre compte aupr√®s de Antoine LE FRAPPER</p>
                                <a href="mailto:antoine.lefrapper@omexom.com?subject=Demande cr√©ation compte Sitemark&body=Bonjour,%0D%0A%0D%0AJe souhaite demander la cr√©ation de mon compte Sitemark.%0D%0A%0D%0ACordialement" class="btn btn-primary">
                                    Envoyer un mail
                                </a>
                            </div>
                            
                            <div class="task-item" data-role="apprenant" data-duration="10‚Äì15 min" data-outcome="Application install√©e et connect√©e">
                                <h4>Installation application mobile Sitemark</h4>
                                <p>Installer l'application sur votre smartphone pour la collecte de donn√©es terrain</p>
                                <div class="app-links">
                                    <a href="https://play.google.com/store/apps/details?id=com.sitemark.fieldlink&pcampaignid=web_share" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                                        Android
                                    </a>
                                    <a href="https://apps.apple.com/fr/app/sitemark-field-link/id6451259304" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                                        iOS
                                    </a>
                                    <a href="https://app.sitemark.com/sites" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                                        Site Web
                                    </a>
                                </div>
                            </div>
                            
                            <div class="task-item" data-role="manager" data-duration="5‚Äì10 min" data-outcome="Demande d'installation effectu√©e">
                                <h4>Installation MS Project sur votre PC</h4>
                                <p>Logiciel de gestion de projet n√©cessaire pour les phases de planification et d'avancement de chantier</p>
                                <span class="info-badge">Contactez le support informatique d'Omexom</span>
                            </div>
                        </div>
                    </div>

                    <div class="subsection">
                        <h3>Formations Nouveaux Arrivants</h3>
                        <div class="task-list">                        
                            <div class="task-item" data-role="apprenant" data-duration="20‚Äì30 min" data-outcome="Module termin√©">
                                <h4>Formation Planificateur Teams</h4>
                                <p>Outil de planification collaborative utilis√© en d√©but de projet</p>
                                <a href="https://pontiva.thinkific.com/courses/PlanificateurTeams" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                                    Commencer la formation
                                </a>
                                <div class="planb" data-planb="thinkific">
                                    <button class="planb-toggle" aria-expanded="true">Plan B ¬∑ Thinkific</button>
                                    <div class="planb-content">
                                        Si la redirection √©choue : connectez-vous √† votre compte Thinkific ‚Üí ouvrez ¬´ Mes cours ¬ª ‚Üí cherchez Planificateur Teams / Sitemark ‚Üí Reprendre.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="task-item" data-role="apprenant" data-duration="20‚Äì30 min" data-outcome="Compte Sitemark actif">
                                <h4>Formation Sitemark</h4>
                                <p>Formation sur l'outil de collecte de donn√©es terrain</p>
                                <a href="https://pontiva.thinkific.com/courses/Sitemark" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                                    Commencer la formation
                                </a>
                                <div class="planb" data-planb="thinkific">
                                    <button class="planb-toggle" aria-expanded="true">Plan B ¬∑ Thinkific</button>
                                    <div class="planb-content">
                                        Si la redirection √©choue : connectez-vous √† votre compte Thinkific ‚Üí ouvrez ¬´ Mes cours ¬ª ‚Üí cherchez Planificateur Teams / Sitemark ‚Üí Reprendre.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Vue Nouveau Projet -->
            <div data-view="nouveau-projet" class="view-container">
                <section class="project-section">
                    <h2>Nouveau projet ‚Äî D√©marrage chantier / Manager</h2>
                    
                    <!-- Bloc Sitemark -->
                    <div class="subsection">
                        <h3>Sitemark</h3>
                        
                        <div class="subsection">
                            <h4>Configuration du projet</h4>
                            <div class="task-list">
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Cr√©ation du site</span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Cr√©ation du devis</span>
                                    </label>
                                    <a href="mailto:charles.andredumont@sitemark.com?cc=idris.abidi@sitemark.com&subject=Demande de devis - Site  Num√©ro d'affaire - Nom du client &body=Bonjour Charles,%0D%0A%0D%0AMerci de nous envoyer un devis pour les prestations suivantes sur le site , s'il te pla√Æt  :%0D%0A%0D%0AVol Marketing%0D%0A%0D%0AVol mi-novembre pour les fondations%0D%0A%0D%0AVol fin mars d√©but avril pour la fin de chantier%0D%0A%0D%0ADigital Twin - Solar Site Advanced ‚Äì Ref. 392-SUB%0D%0A%0D%0ADigital Twin - Field Link Addon ‚Äì Ref. 391-SUB%0D%0A%0D%0AVoici les acc√®s pour le site  :%0D%0A%0D%0ALe devis devra √™tre envoy√© √†  ." class="btn btn-primary btn-small" style="margin-left: 12px;">Envoyer un mail</a>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Syst√®me g√©ographique a demander au BE - <a href="https://teams.microsoft.com/l/entity/2a527703-1f6f-4559-a332-d8a7d288cd88/_djb2_msteams_prefix_1487707578?context=%7B%22channelId%22%3A%2219%3Az28Ri3-tK0r8RgOV1u7tSU0HYQhONG3NlVO3U2vY8EE1%40thread.tacv2%22%7D&tenantId=cae7d061-08f3-40dd-80c3-3c0b8889224a" target="_blank" rel="noopener noreferrer" class="task-link">Acc√©der</a></span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Faire son choix des composants du PDF - <a href="https://teams.microsoft.com/l/entity/2a527703-1f6f-4559-a332-d8a7d288cd88/_djb2_msteams_prefix_1487707578?context=%7B%22channelId%22%3A%2219%3Az28Ri3-tK0r8RgOV1u7tSU0HYQhONG3NlVO3U2vY8EE1%40thread.tacv2%22%7D&tenantId=cae7d061-08f3-40dd-80c3-3c0b8889224a" target="_blank" rel="noopener noreferrer" class="task-link">Acc√©der</a></span>
                                    </label>
                                </div> 
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Faire son choix des composants du DXF - <a href="https://teams.microsoft.com/l/entity/2a527703-1f6f-4559-a332-d8a7d288cd88/_djb2_msteams_prefix_1487707578?context=%7B%22channelId%22%3A%2219%3Az28Ri3-tK0r8RgOV1u7tSU0HYQhONG3NlVO3U2vY8EE1%40thread.tacv2%22%7D&tenantId=cae7d061-08f3-40dd-80c3-3c0b8889224a" target="_blank" rel="noopener noreferrer" class="task-link">Acc√©der</a></span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Cr√©ation des formulaires pour les tickets</span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Cr√©ation des formulaires pour les composants</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="subsection">
                            <h4>Utilisation hebdomadaire</h4>
                            <div class="task-list">
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Pour chaque t√¢che assign√©e, mettre un tag et assigner une personne et une date d'√©ch√©ance</span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Faire un suivi chaque semaine pour fermer les tickets</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bloc MS Project -->
                    <div class="subsection">
                        <h3>MS Project</h3>
                        
                        <div class="subsection">
                            <h4>Configuration du projet</h4>
                            <div class="task-list">
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Excel fichier</span>
                                    </label>
                                    <a href="./templates/FichierTypearemplir.xlsx" download class="btn btn-success btn-small" style="margin-left: 12px;">üì• Fichier Excel type √† remplir</a>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>MS Project</span>
                                    </label>
                                    <a href="./templates/Mod√®leImport.mpt" download class="btn btn-secondary btn-small" style="margin-left: 12px;">üì¶ Mod√®le MS Project</a>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>CONFIGURATION WBS</span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>liaison des t√¢ches</span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>dates</span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>planning de r√©f√©rence</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="subsection">
                            <h4>Utilisation hebdomadaire</h4>
                            <div class="task-list">
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Remplissage de l'avancement physique et heures</span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Utilisation du bouton d'export du dashboard</span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Utiliser la calculatrice Pontiva pour recalculer le travail restant</span>
                                    </label>
                                    <a href="./calculatrice-travail-restant.html" target="_blank" rel="noopener noreferrer" class="btn btn-secondary btn-small" style="margin-left: 12px;">
                                        Ouvrir la calculatrice Pontiva
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bloc Analyse & Pilotage -->
                    <div class="subsection">
                        <h3>Pontiva ‚Äî Analyse & Pilotage du chantier</h3>
                        <div class="task-list">
                            <div class="task-item">
                                <label class="task-checkbox-label">
                                    <input type="checkbox" class="task-checkbox">
                                    <span>Importer le JSON Pontiva (fichier export√© depuis MS Project)</span>
                                </label>
                                <a href="dashboard.html"
                                   target="_blank"
                                   rel="noopener noreferrer"
                                   class="btn btn-primary btn-small"
                                   style="margin-left: 12px;">
                                    Ouvrir le Dashboard Pontiva
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bloc Planificateur Teams -->
                    <div class="subsection">
                        <h3>Planificateur Teams</h3>
                        
                        <div class="subsection">
                            <h4>Configuration du projet</h4>
                            <div class="task-list">
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Copie du plan EPC - <a href="https://teams.microsoft.com/l/entity/com.microsoft.teamspace.tab.planner/mytasks?tenantId=cae7d061-08f3-40dd-80c3-3c0b8889224a&webUrl=https%3A%2F%2Ftasks.teams.microsoft.com%2Fteamsui%2FpersonalApp%2Falltasklists&context=%7B%22subEntityId%22%3A%22%2Fv1%2Fpremiumplan%2Ff19fc843-87b0-4cc2-96bd-c0cde78f7f79%2Forg%2F59675cc6-bab9-416e-b01c-04b99ae59f69%22%7D" target="_blank" rel="noopener noreferrer" class="task-link">Acc√©der au plan EPC</a></span>
                                    </label>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Cr√©ation des guides : Configuration du projet et gestion des t√¢ches</span>
                                    </label>
                                    <div style="margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap;">
                                        <a href="https://scribehow.com/viewer/Module_1__Acceder_et_Organiser_vos_Projets_dans_Microsoft_Teams__3B5J_zGGTqK4Ztty-4FRBQ?referrer=documents" target="_blank" rel="noopener noreferrer" class="btn btn-secondary btn-small">
                                            üìñ Module 1 : Acc√©der et Organiser vos Projets
                                        </a>
                                        <a href="https://scribehow.com/viewer/Module_2__Gerer_et_Suivre_lAvancement_des_Taches_dans_Planificateur_TEAMS__b19C7v_xRkWVtAS-H4YiVQ?referrer=documents" target="_blank" rel="noopener noreferrer" class="btn btn-secondary btn-small">
                                            üìñ Module 2 : G√©rer et Suivre l'Avancement des T√¢ches
                                        </a>
                                    </div>
                                </div>
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Tags : Configuration des filtres (projets, lots, personnes)</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="subsection">
                            <h4>Utilisation hebdomadaire</h4>
                            <div class="task-list">
                                <div class="task-item">
                                    <label class="task-checkbox-label">
                                        <input type="checkbox" class="task-checkbox">
                                        <span>Mise en place en r√©union hebdomadaire : Mettez toujours une personne en assignation & une date d'√©ch√©ance. Tags pour filtrer par projets, lots, par personne</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <div class="update-info" id="last-updated" aria-live="polite"></div>
            </div>
        </footer>
    </div>

    <script>
        /**
         * Encode correctement un chemin de fichier en pr√©servant les s√©parateurs de dossiers.
         * Cette fonction encode chaque segment du chemin s√©par√©ment pour √©viter les bugs d'encodage
         * avec les espaces et caract√®res sp√©ciaux.
         * @param {string} path - Le chemin √† encoder
         * @returns {string} Le chemin encod√© correctement
         */
        function encodePath(path) {
            if (!path) return '';
            // S√©parer le chemin en segments et encoder chaque segment individuellement
            return path.split('/').map(segment => encodeURIComponent(segment)).join('/');
        }

        // Chargement dynamique des macros depuis manifest.json
        async function loadMacros() {
            const macrosContainer = document.getElementById('macros-list');
            
            try {
                const response = await fetch('./macros/manifest.json');
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Vider le message de chargement
                macrosContainer.innerHTML = '';
                
                // G√©n√©rer uniquement les cartes demand√©es (√©vite 404 tant que tous les chemins ne sont pas normalis√©s)
                const allowedNames = new Set([
                    'avancement-physique-vs-heures',
                    'calculatrice-reste-a-faire'
                ]);
                data.macros.filter(m => allowedNames.has(m.name)).forEach(macro => {
                    const macroCard = document.createElement('div');
                    macroCard.className = 'macro-card';
                    
                    // Encoder les URLs pour g√©rer les espaces et caract√®res sp√©ciaux
                    const encodedHtmlFile = encodePath(macro.htmlFile);
                    const encodedBasFile = encodePath(macro.basFile);
                    
                    let actionsHtml = `
                        <a href="./macros/${encodedHtmlFile}" target="_blank" class="btn btn-secondary btn-small">
                            üìñ Documentation
                        </a>
                        <a href="./macros/${encodedBasFile}" download class="btn btn-primary btn-small">
                            üíæ T√©l√©charger
                        </a>
                    `;
                    // Ajout des boutons Excel/MPT pour la macro Import Simple (chemins manifest, compatibles avec encodage)
                    if (macro.name === 'creation-ms-project') {
                        const excel = encodePath(macro.excelFile);
                        const mpt = encodePath(macro.mptFile);
                        actionsHtml = `
                            <a href="./macros/${encodedHtmlFile}" target="_blank" class="btn btn-secondary btn-small">
                                üìñ Documentation
                            </a>
                            ${excel ? `<a href="./macros/${excel}" download class="btn btn-success btn-small" style="margin-top:4px;">üì•Fichier Excel type √† remplir</a>` : ''}
                            ${mpt ? `<a href="./macros/${mpt}" download class="btn btn-secondary btn-small" style="margin-top:4px;">Mod√®le MS Project</a>` : ''}
                        `;
                    }
                    
                    // Ajouter les actions sp√©cifiques pour la calculatrice reste √† faire
                    if (macro.name === 'calculatrice-reste-a-faire') {
                        actionsHtml = `
                            <a href="./macros/${encodedHtmlFile}" target="_blank" class="btn btn-secondary btn-small">
                                üìñ Documentation
                            </a>
                            <button onclick="downloadFormFiles('${macro.name}')" class="btn btn-primary btn-small">
                                üì¶ T√©l√©charger Forms (.frm + .frx)
                            </button>
                        `;
                    }
                    
                    macroCard.innerHTML = `
                        <div class="macro-header">
                            <h5 class="macro-title">
                                <a href="./macros/${encodedHtmlFile}" target="_blank" class="macro-link">
                                    ${macro.title}
                                </a>
                            </h5>
                            ${macro.lastUpdated ? `<span class="macro-date">Mis √† jour le ${macro.lastUpdated}</span>` : ''}
                        </div>
                        <p class="macro-description">${macro.description}</p>
                        <div class="macro-actions">
                            ${actionsHtml}
                        </div>
                    `;
                    
                    macrosContainer.appendChild(macroCard);
                });
                
            } catch (error) {
                console.error('Erreur lors du chargement des macros:', error);
                macrosContainer.innerHTML = `
                    <div class="error-message">
                        ‚ùå Impossible de charger les macros VBA
                        <br><small>V√©rifiez que le fichier manifest.json est accessible</small>
                    </div>
                `;
            }
        }
        
        // Fonction pour t√©l√©charger les fichiers forms en ZIP
        async function downloadFormFiles(macroName) {
            try {
                // R√©cup√©rer les informations de la macro
                const response = await fetch('./macros/manifest.json');
                const data = await response.json();
                const macro = data.macros.find(m => m.name === macroName);
                
                if (!macro || !macro.hasZipDownload) {
                    alert('T√©l√©chargement ZIP non disponible pour cette macro.');
                    return;
                }
                
                // Cr√©er un zip avec JSZip
                const JSZip = (await import('https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm')).default;
                const zip = new JSZip();
                
                // T√©l√©charger et ajouter le fichier .frm
                const frmResponse = await fetch(`./macros/${encodePath(macro.frmFile)}`);
                const frmBlob = await frmResponse.blob();
                zip.file('datecalcul.frm', frmBlob);
                
                // T√©l√©charger et ajouter le fichier .frx
                const frxResponse = await fetch(`./macros/${encodePath(macro.frxFile)}`);
                const frxBlob = await frxResponse.blob();
                zip.file('datecalcul.frx', frxBlob);
                
                // G√©n√©rer et t√©l√©charger le ZIP
                const zipBlob = await zip.generateAsync({type: 'blob'});
                const url = URL.createObjectURL(zipBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'calculatrice_datecalcul_forms.zip';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
            } catch (error) {
                console.error('Erreur lors du t√©l√©chargement ZIP:', error);
                alert('Erreur lors du t√©l√©chargement des fichiers. Veuillez r√©essayer.');
            }
        }
        
        /**
         * Corrige automatiquement tous les liens avec des chemins non encod√©s.
         * Cette fonction s'ex√©cute au chargement pour √©viter les bugs d'encodage.
         */
        function fixUnencodedLinks() {
            document.querySelectorAll('a[href*="./macros/"]').forEach(link => {
                const href = link.getAttribute('href');
                if (href && !href.includes('%')) {
                    // Si le lien contient des espaces ou caract√®res sp√©ciaux non encod√©s
                    const pathMatch = href.match(/\.\/macros\/(.+)$/);
                    if (pathMatch) {
                        const path = pathMatch[1];
                        // V√©rifier si le chemin contient des caract√®res non encod√©s (espaces, accents, etc.)
                        if (path.includes(' ') || /[√†√°√¢√£√§√•√®√©√™√´√¨√≠√Æ√Ø√≤√≥√¥√µ√∂√π√∫√ª√º√Ω√ø√ß]/.test(path)) {
                            link.setAttribute('href', `./macros/${encodePath(path)}`);
                        }
                    }
                }
            });
        }

        // Charger les macros au chargement de la page
        document.addEventListener('DOMContentLoaded', () => {
            fixUnencodedLinks();
            loadMacros();
        });
    </script>
    <script src="assets/onboarding.js"></script>
</body>
</html>